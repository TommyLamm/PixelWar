# 第一人称摄像机系统实现说明

## ✅ 已完成功能

### 1. Camera 类实现
- ✅ **位置向量** (glm::vec3 position)
- ✅ **前向向量** (glm::vec3 front)
- ✅ **上向量** (glm::vec3 up)
- ✅ **右向量** (glm::vec3 right)
- ✅ **世界坐标系上向量** (glm::vec3 worldUp)
- ✅ **Pitch 角度**（俯仰角，限制在 -89° 到 89°）
- ✅ **Yaw 角度**（偏航角）
- ✅ **移动速度**（可配置）
- ✅ **鼠标灵敏度**（可配置）

### 2. 矩阵计算
- ✅ **View Matrix (观察矩阵)**: 使用 `glm::lookAt()` 计算
- ✅ **Projection Matrix (投影矩阵)**: 使用 `glm::perspective()` 计算

### 3. 输入处理
- ✅ **鼠标移动**: 控制视角旋转（Pitch 和 Yaw）
- ✅ **键盘输入**: WASD 控制摄像机前后左右移动
- ✅ **鼠标滚轮**: 调整 FOV（视场角）

### 4. 鼠标光标控制
- ✅ **隐藏鼠标光标**: 使用 `GLFW_CURSOR_DISABLED`
- ✅ **锁定在窗口中心**: GLFW 自动处理光标重定位

## 📁 文件结构

```
src/
├── Camera.h          # 摄像机类头文件
├── Camera.cpp        # 摄像机类实现文件
└── main.cpp          # 主程序（已集成摄像机系统）
```

## 🔧 核心功能说明

### Camera 类接口

#### 构造函数
```cpp
Camera(
    glm::vec3 position = glm::vec3(0.0f, 0.0f, 0.0f),
    glm::vec3 up = glm::vec3(0.0f, 1.0f, 0.0f),
    float yaw = -90.0f,
    float pitch = 0.0f
);
```

#### 主要方法
- `GetViewMatrix()`: 获取观察矩阵
- `GetProjectionMatrix()`: 获取投影矩阵
- `ProcessKeyboard()`: 处理键盘输入（WASD）
- `ProcessMouseMovement()`: 处理鼠标移动
- `ProcessMouseScroll()`: 处理鼠标滚轮

### 输入控制

#### 键盘控制
- **W**: 向前移动
- **S**: 向后移动
- **A**: 向左移动
- **D**: 向右移动
- **ESC**: 退出程序

#### 鼠标控制
- **鼠标移动**: 控制视角旋转
  - 水平移动：Yaw（左右旋转）
  - 垂直移动：Pitch（上下旋转）
- **鼠标滚轮**: 调整 FOV（缩放）

## 🎮 使用方法

### 1. 初始化摄像机
```cpp
Camera camera(glm::vec3(0.0f, 0.0f, 3.0f));
camera.SetMovementSpeed(2.5f);
camera.SetMouseSensitivity(0.1f);
```

### 2. 在游戏循环中更新
```cpp
// 计算时间差
float currentFrame = static_cast<float>(glfwGetTime());
float deltaTime = currentFrame - lastFrame;
lastFrame = currentFrame;

// 处理键盘输入
if (glfwGetKey(window, GLFW_KEY_W) == GLFW_PRESS)
    camera.ProcessKeyboard(Camera::Movement::FORWARD, deltaTime);

// 获取矩阵
glm::mat4 view = camera.GetViewMatrix();
glm::mat4 projection = camera.GetProjectionMatrix(45.0f, aspectRatio, 0.1f, 100.0f);
```

### 3. 鼠标回调设置
```cpp
// 隐藏并锁定鼠标光标
glfwSetInputMode(window, GLFW_CURSOR, GLFW_CURSOR_DISABLED);

// 注册鼠标回调
glfwSetCursorPosCallback(window, MouseCallback);
glfwSetScrollCallback(window, ScrollCallback);
```

## 🔍 技术细节

### 欧拉角系统
- **Yaw (偏航角)**: 水平旋转，范围无限制
- **Pitch (俯仰角)**: 垂直旋转，限制在 -89° 到 89°（防止翻转）

### 向量计算
使用球面坐标公式计算前向向量：
```cpp
front.x = cos(pitch) * sin(yaw)
front.y = sin(pitch)
front.z = cos(pitch) * cos(yaw)
```

然后通过叉积计算右向量和上向量，确保形成正交基。

### 帧率独立移动
使用 `deltaTime` 确保移动速度与帧率无关：
```cpp
float velocity = movementSpeed * deltaTime;
position += direction * velocity;
```

## ⚙️ 配置参数

### 默认值
- **移动速度**: 2.5 单位/秒
- **鼠标灵敏度**: 0.1
- **FOV**: 45 度
- **初始位置**: (0, 0, 3)
- **初始 Yaw**: -90 度（看向 -Z 轴）
- **初始 Pitch**: 0 度（水平）

### 可调整参数
- `SetMovementSpeed(float)`: 设置移动速度
- `SetMouseSensitivity(float)`: 设置鼠标灵敏度
- `SetFOV(float)`: 设置视场角（1° - 45°）

## 🚀 编译和运行

### 编译
```bash
cd build
cmake ..
cmake --build . --config Release
```

### 运行
```bash
.\Release\L4D2_NoEngine.exe
```

### 操作说明
1. 程序启动后，鼠标光标会自动隐藏并锁定在窗口中心
2. 移动鼠标可以旋转视角
3. 使用 WASD 键移动摄像机
4. 使用鼠标滚轮调整 FOV（缩放）
5. 按 ESC 键退出

## 📝 注意事项

1. **首次鼠标移动**: 程序会忽略首次鼠标移动的大幅跳跃，避免视角突然变化
2. **Pitch 限制**: Pitch 角度被限制在 -89° 到 89° 之间，防止摄像机翻转
3. **鼠标坐标**: 屏幕坐标 Y 轴是反的，需要取反处理
4. **时间计算**: 使用 `glfwGetTime()` 获取高精度时间，确保帧率独立

## 🔄 后续扩展方向

- [ ] 添加 Roll（翻滚）角度支持
- [ ] 实现摄像机平滑插值
- [ ] 添加摄像机边界限制
- [ ] 实现摄像机碰撞检测
- [ ] 添加多种摄像机模式（第一人称/第三人称/自由视角）
- [ ] 实现摄像机动画系统

## ✅ 总结

第一人称摄像机系统已完全实现，包括：
- ✅ 完整的 Camera 类
- ✅ View 和 Projection 矩阵计算
- ✅ 鼠标和键盘输入处理
- ✅ 鼠标光标隐藏和锁定
- ✅ 帧率独立的移动系统

系统已集成到主程序中，可以直接编译运行测试！

